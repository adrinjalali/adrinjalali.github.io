<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Adrin Jalali</title><link href="http://adrin.info/" rel="alternate"></link><link href="http://adrin.info/feeds/sysadmin.atom.xml" rel="self"></link><id>http://adrin.info/</id><updated>2015-08-07T00:00:00+02:00</updated><entry><title>Zimbra Auto Provisioning fromÂ FreeIPA</title><link href="http://adrin.info/zimbra-auto-provisioning-from-freeipa.html" rel="alternate"></link><published>2015-08-07T00:00:00+02:00</published><updated>2015-08-07T00:00:00+02:00</updated><author><name>adrin</name></author><id>tag:adrin.info,2015-08-07:zimbra-auto-provisioning-from-freeipa.html</id><summary type="html">&lt;p&gt;After quite a few days struggling to configure a Zimbra server so that it automatically fetches users from our freeIPA (&lt;span class="caps"&gt;LDAP&lt;/span&gt;) server, I finally managed to have a configuration which works. I got help from a bunch of pages like &lt;a href="http://imanudin.net/2014/12/09/zimbra-external-ad-automatically-create-mailboxes-zimbra-with-lazy-mode-auto-provisioning/"&gt;this&lt;/a&gt; and &lt;a href="https://www.zimbra.com/docs/ne/8.0.2/administration_guide/wwhelp/wwhimpl/js/html/wwhelp.htm#href=ZCS_8_0_2_Admin_Guide.Auto_Provisioning_New_Accounts_from_External_LDAP.html"&gt;this&lt;/a&gt; one. This comes after you fix the external &lt;span class="caps"&gt;LDAP&lt;/span&gt; authentication and probably also external &lt;span class="caps"&gt;GAL&lt;/span&gt; configuration on your Zimbra&amp;nbsp;server.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;zmprov&lt;/code&gt; gives you a nice terminal to configure the&amp;nbsp;server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ su - zimbra
$ zmprov
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This is the set of commands I used to set it&amp;nbsp;up:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;prov&amp;gt; md mysampledomain.net zimbraAutoProvAccountNameMap &amp;quot;uid&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvAttrMap &amp;quot;givenName=givenName&amp;quot;
prov&amp;gt; md mysampledomain.net +zimbraAutoProvAttrMap &amp;quot;sn=sn&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvBatchSize 80
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapAdminBindDn &amp;quot;uid=mail_server,cn=users,cn=accounts,dc=mysampledomain,dc=net&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapAdminBindPassword &amp;quot;myverysecretpassword&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapBindDn &amp;quot;uid=mail_server,cn=users,cn=accounts,dc=mysampledomain,dc=net&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapSearchBase &amp;quot;cn=accounts,dc=mysampledomain,dc=net&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapSearchFilter &amp;quot;(&amp;amp;(ObjectClass=person))&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapStartTlsEnabled TRUE
prov&amp;gt; md mysampledomain.net zimbraAutoProvLdapURL &amp;quot;ldaps://ipa.mysampledomain.net:636&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvPollingInterval &amp;quot;10m&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvScheduledDomains &amp;quot;mysampledomain.net&amp;quot;
prov&amp;gt; md mysampledomain.net zimbraAutoProvMode &amp;quot;EAGER&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To diagnose why the system wasn&amp;#8217;t working, I also had to figure out where the log files are, and how to produce more logs. Oddly enough, they&amp;#8217;re not in &lt;code&gt;/var/log&lt;/code&gt;, and instead they are written by default in &lt;code&gt;/opt/zimbra/log/mailbox.log&lt;/code&gt;, or other related files in that folder. I added &lt;code&gt;log4j.logger.zimbra.autoprov=TRACE&lt;/code&gt; at the end of my &lt;code&gt;/opt/zimbra/conf/log4j.properties&lt;/code&gt; file, which will be overwritten next time I restart the services using the configurations in &lt;code&gt;/opt/zimbra/conf/log4j.properties.in&lt;/code&gt;. Finally to make the logging system reload the logging configuration, you need to run &lt;code&gt;zmprov rlog&lt;/code&gt;. You find more info &lt;a href="http://wiki.zimbra.com/wiki/Using_log4j_to_Configure_mailboxd_Logging"&gt;here&lt;/a&gt;.&lt;/p&gt;</summary><category term="zimbra"></category><category term="freeipa"></category><category term="ldap"></category></entry></feed>